<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Pslight harness</title>
    <style>
        :root {
            --color: #000000;
        }

        body {
            background-color: black;
            padding: 20px;
            text-align: center;
            color: white;
        }

        #strip {
            display: flex;
            justify-content: space-between;
            --size: calc(45vw / var(--leds))
        }

        .light {
            width: var(--size);
            height: var(--size);
            border-radius: 50%;
            display: inline-flex;
            filter: blur(2px);
            position: relative;
            align-items: center;
            justify-content: center;
            background-color: var(--color);
            overflow: visible;
        }

        .light::before {
            content: "";
            width: calc(var(--size) * 4);
            height: calc(var(--size) * 4);
            top: calc(var(--size) * -1.5);
            left: calc(var(--size) * -1.5);
            background-color: var(--color);
            opacity: 0.5;
            position: absolute;
            filter: blur(var(--size));
        }


        .light::after {
            content: "";
            width: 6px;
            height: 3px;
            background-color: rgba(255, 255, 255, 0.5);
        }
    </style>

</head>

<body>

    <div id="strip"></div>

    <br /><br /><br /><br /><br /><br />

    <div class="controls">
        <input type="checkbox" id="cb_p" disabled onInput="ws.send('p:' + +this.checked)" />
        <label for="cb_p">Playstation Power</label>

        <input type="checkbox" id="cb_1" disabled onInput="ws.send('1:' + +this.checked)" />
        <label for="cb_1">Player 1 online</label>

        <input type="checkbox" id="cb_2" disabled onInput="ws.send('2:' + +this.checked)" />
        <label for="cb_2">Player 2 online</label>

        <input type="checkbox" id="cb_3" disabled onInput="ws.send('3:' + +this.checked)" />
        <label for="cb_3">Player 3 online</label>

        <input type="checkbox" id="cb_4" disabled onInput="ws.send('4:' + +this.checked)" />
        <label for="cb_4">Player 4 online</label>
    </div>

    <script>
        'use strict';

        const ws = window.$ws = new WebSocket('ws://localhost:8085/');
        const leds = [];
        const strip = document.getElementById("strip");
        ws.onmessage = function (event) {
            console.log(event.data);
            const [type, payload] = event.data.split(':', 2);
            switch (type) {
                case 'l': {
                    payload.split('-').forEach((c, i) => {
                        let led = leds[i];
                        if (!led) {
                            led = document.createElement("div");
                            led.className = "light";
                            leds.push(led);
                            strip.appendChild(led);
                            strip.style.setProperty('--leds', leds.length);
                        }
                        led.style.setProperty('--color', '#' + c);
                    });
                    break;
                }

                case 'p':
                case '1':
                case '2':
                case '3':
                case '4':
                    document.getElementById('cb_' + type).removeAttribute('disabled');
                    document.getElementById('cb_' + type).checked = payload === '1';
                    break;
            }

        };

        function enableButton(id, enabled) {
            if (enabled) {
                document.getElementById(id).removeAttribute('disabled');
            } else {
                document.getElementById(id).setAttribute('disabled', true);
            }
        }
    </script>
</body>

</html>